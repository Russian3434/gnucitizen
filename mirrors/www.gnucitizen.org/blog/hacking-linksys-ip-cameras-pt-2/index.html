<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
	
<!-- Mirrored from www.gnucitizen.org/blog/hacking-linksys-ip-cameras-pt-2/ by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 07 Jul 2012 14:22:51 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
		<link rel="profile" href="http://gmpg.org/xfn/11"/>
		<link rel="pingback" href="../../wordpress/xmlrpc.php" />
		<link rel="alternate" type="application/rdf+xml" title="GNUCITIZEN" href="../../feed/rdf/index.html"/>
		<link rel="alternate" type="application/rss+xml" title="GNUCITIZEN" href="../../feed/rss/index.html"/>
		<link rel="alternate" type="application/atom+xml" title="GNUCITIZEN" href="../../feed/atom/index.html"/>
		<link rel="stylesheet" type="text/css" href="../../wordpress/wp-content/themes/gnucitizen.org-v2/style.css"/>
		<title>GNUCITIZEN &raquo; Hacking Linksys IP Cameras (pt 2)</title>
			<meta name="google-site-verification" content="yfE2zXU6xxSUp1CWarDop_6vVdGUUplpLF8P5Xe2fWM"/>
	<link rel="icon" href="../../wordpress/wp-content/themes/gnucitizen.org-v2/styles/images/favicon.ico" type="image/x-icon"/>
	<link rel="alternate" type="application/rss+xml" title="GNUCITIZEN Comments" href="http://feedproxy.google.com/gnucitizenComments"/>
	<link rel="alternate" type="application/rss+xml" title="GNUCITIZEN Group" href="http://feedproxy.google.com/gnucitizenGroup"/>
	<link rel="stylesheet" href="../../wordpress/wp-content/themes/gnucitizen.org-v2/scriptlets/slimbox2/slimbox2.css" type="text/css" media="screen"/>
	<script src="../../wordpress/wp-content/themes/gnucitizen.org-v2/scripts/jquery.core.js" type="text/javascript"></script>
	<script src="../../wordpress/wp-content/themes/gnucitizen.org-v2/scriptlets/slimbox2/slimbox2.js" type="text/javascript"></script>
	<script src="../../wordpress/wp-content/themes/gnucitizen.org-v2/scripts/gnucitizen.common.js" type="text/javascript"></script>
<link rel="alternate" type="application/rss+xml" title="GNUCITIZEN &raquo; Hacking Linksys IP Cameras (pt 2) Comments Feed" href="feed/index.html" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../wordpress/xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.gnucitizen.org/wordpress/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Hacking Linksys IP Cameras (pt 1)' href='../hacking-linksys-ip-cameras-pt-1/index.html' />
<link rel='next' title='Hacking Linksys IP Cameras (pt 3)' href='../hacking-linksys-ip-cameras-pt-3/index.html' />
<meta name="generator" content="WordPress 3.3.2" />
<link rel='canonical' href='index.html' />
<link rel='shortlink' href='../../indexae17.html?p=2978' />
<link rel="alternate" type="application/rss+xml" title="GNUCITIZEN Network" href="http://feedproxy.google.com/gnucitizenNetwork"/>	</head>
	
	<body id="single" class="blog">
		<div id="header">
			<h1><a href="../../index.html"><span>GNUCITIZEN</span></a></h1>
			<p><span>Information Security Think Tank</span></p>
		</div>

<div id="navigation">
	<h2>Navigation</h2>
	<ul>
		<li class="cat-item cat-item-2"><a href="../../categories/blog/index.html" title="View all posts filed under Blog">Blog</a></li>
		<li class="page_item page-item-266"><a href="../../archive/index.html">Archive</a></li>
<li class="page_item page-item-236"><a href="../../about/index.html">About</a></li>
<li class="page_item page-item-336"><a href="../../index.html">Home</a></li>
			</ul>
</div>

<div id="content">
			<div id="entry">
							<div id="post-2978" class="post">
	<div class="post-title"><h2><span>Hacking Linksys IP Cameras (pt 2)</span></h2></div>
	<div class="post-date"><span>published:</span> April 20th, 2009</div>
	<div class="post-content"><div class="single-content-top-widgets"></div><p><em>This article is a continuation of the following GNUCITIZEN article, which includes an introduction to the topic and also some initial observations: <a href="../hacking-linksys-ip-cameras-pt-1/index.html">Hacking Linksys IP Cameras (pt 1)</a>.</em></p>

<h3>Privilege escalation via arbitrary file retrieval</h3>

<p>The second vulnerability I&#8217;ll be releasing is an arbitrary(ish) file retrieval vulnerability. It&#8217;s not fully arbitrary because you can only retrieve the contents of files located within the same directory where the vulnerable CGI program is located. However, this is enough to allow a neat privilege escalation vector where a restricted user that only has permissions to view the video stream, can gain access to the <code>admin</code> account password.</p>

<p>The problem lies within the <code>next_file</code> parameter which is submitted to the <code>main.cgi</code> program. Although <code>main.cgi</code> <em>does</em> filter characters typically used in directory traversal sequences such as dots (<code>.</code>) and forward slashes (<code>/</code>), it seems that the developer didn&#8217;t consider that retrieving the contents of files within the current directory could create a security hole. By simply retrieving the contents of <code>.htpasswd</code> a restricted user which only has permissions to access the video stream can access the credentials of the <code>admin</code> account and also the credentials of other restricted users (if applicable).</p>

<p>The only restriction that needs to be bypassed, is dots (<code>.</code>) symbols being filtered. i.e.: the following will <em>not</em> work and will result in a forbidden error:</p>

<pre><code>/img/main.cgi?next_file=.htpasswd</code></pre>

<p>But replacing the dot (<code>.</code>) symbol with its hexadecimal equivalent:</p>

<pre><code>/img/main.cgi?next_file=%2ehtpasswd</code></pre>

<p>Will result in the contents of <code>.htpasswd</code> being returned. i.e.:</p>

<pre><code>admin:adminpassw0rd user1:pass1 user2:pass2</code></pre>

<p>Like most IP cameras, the Linksys WVC54GCA allows administrators to grant access to the video stream to selected users only (rather than anonymous users who don&#8217;t need to authenticate). In this case, the admin user can click on the <code>Users</code> menu and tick the <code>Only users in database</code> option (please see screenshot below). After this, all that is needed is to add a username/password pair for the account to grant video-viewing access to:</p>

<div class="screen"><img src="../../static/blog/2009/04/video_user_accounts.png" alt="Video User Accounts" title="Video User Accounts" width="489" height="227" class="alignnone size-full wp-image-2990" /></div>

<p>Well, the feature discussed above can be rendered useless by exploiting the vulnerability I have described, since it allows restricted users to retrieve the admin password.</p>

<h3>Testing Info</h3>

<p>Successfully tested on:</p>
<p><ul>
<li>WVC54GCA</li>
<li>Firmware V1.00R22 and V1.00R24 (latest available as on 20th April 2009)</li>
</ul>

<p><em>Please note that this vulnerability is different to <a href="http://www.securityfocus.com/bid/10476/exploit">BID 10476</a> which affected the <code>/main.cgi</code> program rather than <code>/img/main.cgi</code>.</em></p><div class="single-content-bottom-widgets"></div></div>
		<div class="post-links"><a href="index.html">more</a> | <a href="index.html#post-comments">comments</a> | <a href='feed/index.html'>comments rss</a> | posted by <a href="../../author/pagvac/index.html" title="Posts by pagvac" rel="author">pagvac</a></div>
	<div class="post-tags">Tags: <a href="../../tags/camera/index.html" rel="tag">camera</a> | <a href="../../tags/linksys/index.html" rel="tag">linksys</a> | <a href="../../tags/vulnerability/index.html" rel="tag">vulnerability</a></div></div>
				

				<div id="post-comments">
					<div class="comment even thread-even depth-1" id="comment-126752">
				<div class="comment-author vcard">
		<img alt='' src='http://0.gravatar.com/avatar/8d7189421b28807d01436d5fa2efba35?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn">A</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-126752">
			May 1, 2009 at 6:32 pm</a>		</div>

		<p>If you can encode the dot using its hexadecimal representation, what prevents you from doing the same with slash, so you can achieve directory traversal?</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment odd alt thread-odd thread-alt depth-1" id="comment-126876">
				<div class="comment-author vcard">
		<img alt='' src='http://1.gravatar.com/avatar/9981128333e23cf10d35cf5c2eb80972?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn">chipxsd</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-126876">
			May 6, 2009 at 11:24 am</a>		</div>

		<p>It really works &#8230; damn, I&#8217;m throwing my camera under a VPN. Don&#8217;t want nobody catching me in an awkward situation :/</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment byuser comment-author-pagvac bypostauthor even thread-even depth-1" id="comment-126904">
				<div class="comment-author vcard">
		<img alt='' src='http://0.gravatar.com/avatar/0367b81839d31a5fa3d7bea79ef71b9e?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn"><a href='http://www.linkedin.com/in/pagvac' rel='external nofollow' class='url'>pagvac</a></cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-126904">
			May 7, 2009 at 2:56 pm</a>		</div>

		<p>@A: that doesn&#8217;t work. thttpd&#8217;s default forbidden error page is returned when trying so.</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment odd alt thread-odd thread-alt depth-1" id="comment-127684">
				<div class="comment-author vcard">
		<img alt='' src='http://1.gravatar.com/avatar/95cff9e99f364a363e3dd43189899b23?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn">balt</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-127684">
			August 7, 2009 at 11:05 pm</a>		</div>

		<p>That works indeed, as long as you&#8217;re logged in. As long as you only allow one admin user and that&#8217;s you, it is probably a non-issue.</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment even thread-even depth-1" id="comment-127702">
				<div class="comment-author vcard">
		<img alt='' src='http://1.gravatar.com/avatar/d72bfb37b3d2b0546d2aaac936b62aee?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn">Rayan</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-127702">
			August 10, 2009 at 11:47 pm</a>		</div>

		<p>Correct, that only works if you are logged in in another browser session. Try that by closing down all your browsers and then try again with a clean session, it will prompt for the Username and password, if you skip that it will error out.</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment byuser comment-author-pagvac bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-127704">
				<div class="comment-author vcard">
		<img alt='' src='http://0.gravatar.com/avatar/0367b81839d31a5fa3d7bea79ef71b9e?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn"><a href='http://www.linkedin.com/in/pagvac' rel='external nofollow' class='url'>pagvac</a></cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-127704">
			August 11, 2009 at 9:58 am</a>		</div>

		<p>@balt: indeed you need to be logged in. BUT, you DON&#8217;T need admin privileges. You can login as a RESTRICTED user (video-viewing permissions only), steal the admin password and finally login as admin. Thus, this vuln serves as a privilege escalation vector as explained in the post.</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment even thread-even depth-1" id="comment-127771">
				<div class="comment-author vcard">
		<img alt='' src='http://1.gravatar.com/avatar/7ab0bb8042f8d317499cbd2220faaf8b?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn">kwharrigan</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-127771">
			August 18, 2009 at 1:00 am</a>		</div>

		<p>Indeed.  If you have any user accounts enabled, and they have weak passwords, you might as well have given up your admin account. Seems it is better to run with no passwords than with them as your admin account password is now tied to the strength of N users accounts.</p>
<p>Wow.</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment odd alt thread-odd thread-alt depth-1" id="comment-128494">
				<div class="comment-author vcard">
		<img alt='' src='http://0.gravatar.com/avatar/69b7e454a53bb71c404a467f510adda4?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn">Cam</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-128494">
			April 25, 2010 at 5:51 pm</a>		</div>

		<p>The more recent version of the firmware 1.100R2 resolves this important issue.  Thanks for pointing it out &#8211; I&#8217;m sure that&#8217;s how Linksys/Cisco fixed the problem.  The software on this camera is still a joke- unsigned activeX control for a security camera.  That&#8217;s crazy.</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment even thread-even depth-1" id="comment-128495">
				<div class="comment-author vcard">
		<img alt='' src='http://0.gravatar.com/avatar/69b7e454a53bb71c404a467f510adda4?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn">Cam</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-128495">
			April 25, 2010 at 5:55 pm</a>		</div>

		<p>Should have checked before posting &#8211; the latest 1.100R2 firmware includes a signed ActiveX control (finally!)</p>

		<div class="reply">
				</div>
		</div>
		</div>
		
		<div class="post-comments-navigation">
			<div class="older-comments"></div>
			<div class="newer-comments"></div>
		</div>
	
	<div id="post-response">
		<h2>Respond</h2>
					<form action="http://www.gnucitizen.org/wordpress/wp-comments-post.php" name="response-form" method="post" class="response-form">
				<p><em>We retain the right to remove any comment or trackback we determine to be, at our sole discretion, unacceptable.</em></p>
									<div><label for="author">name: (required)</label></div>
					<div><input type="text" name="author" id="author" value="" size="20" tabindex="1"/></div>
					<div><label for="email">mail: (required)</label></div>
					<div><input type="text" name="email" id="email" value="" size="20" tabindex="2"/></div>
					<div><label for="url">website:</label></div>
					<div><input type="text" name="url" id="url" value="" size="20" tabindex="3"/></div>
								<div><label for="comment">comment:</label></div>
				<div><textarea name="comment" id="comment" cols="50" rows="10" tabindex="4"></textarea></div>
				<div>
					<input class="button" name="submit" type="submit" id="submit" tabindex="5" value="submit"/>
					<input class="button" name="reset" type="reset" id="reset" tabindex="6" value="reset"/>
				</div>
				<input type="hidden" name="comment_post_ID" value="2978"/>
				<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="d6d007bf92" /></p>

	<p style="clear: both;" class="subscribe-to-comments">
	<input type="checkbox" name="subscribe" id="subscribe" value="subscribe" style="width: auto;" />
	<label for="subscribe">Notify me of followup comments via e-mail</label>
	</p>


			</form>
			</div>
					</div>
		<div id="content-sidebar">					<div class="widget">			<p style="font-size:24px"><em>Get <a href="http://www.websecurify.com/">Websecurify</a> - a cross-platform web security testing technology designed from the ground up with simplicity in mind.</em></p>			</div>			</div></div>

				
		<div id="footer">
			
	<script type="text/javascript">
		var gaJsHost = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.');
		document.write(unescape('%3Cscript src="' + gaJsHost + 'google-analytics.com/ga.js" type="text/javascript"%3E%3C/script%3E'));
	</script>
	<script type="text/javascript">
		var pageTracker = _gat._getTracker('UA-363996-1');
		pageTracker._initData();
		pageTracker._trackPageview();
	</script>

				<p>(<a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/2.5/" title="Creative Commons Attribution-Noncommercial-No Derivative Works 2.5 Generic">CC</a>)2005-2012 <a href="../../index.html" title="Information Security Think Tank">GNUCITIZEN</a></p>
		</div>
		
		<!-- <rdf:RDF xmlns="http://web.resource.org/cc/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
			<Work rdf:about="">
				<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/2.5/"/>
				<dc:title>GNUCITIZEN</dc:title>
				<dc:date>2005-2012</dc:date>
				<dc:creator><Agent><dc:title>GNUCITIZEN</dc:title></Agent></dc:creator>
				<dc:rights><Agent><dc:title>GNUCITIZEN</dc:title></Agent></dc:rights>
				<dc:type rdf:resource="http://purl.org/dc/dcmitype/Text"/>
				<dc:source rdf:resource="http://www.gnucitizen.org"/>
			</Work>
			<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/2.5/">
				<permits rdf:resource="http://web.resource.org/cc/Reproduction"/>
				<permits rdf:resource="http://web.resource.org/cc/Distribution"/>
				<requires rdf:resource="http://web.resource.org/cc/Notice"/>
				<requires rdf:resource="http://web.resource.org/cc/Attribution"/>
				<prohibits rdf:resource="http://web.resource.org/cc/CommercialUse"/>
			</License>
		</rdf:RDF> -->
		
		<!-- tested by blogsecurify -->
		<!-- wpscanner -->
	</body>

<!-- Mirrored from www.gnucitizen.org/blog/hacking-linksys-ip-cameras-pt-2/ by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 07 Jul 2012 14:22:52 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
</html>
