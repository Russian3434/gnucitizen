<?xml version="1.0"?>
<!DOCTYPE bindings [
<!ENTITY % brand-dtd SYSTEM "chrome://branding/locale/brand.dtd">%brand-dtd;
<!ENTITY % bindings-dtd SYSTEM "chrome://websecurify/locale/bindings.dtd">%bindings-dtd;
]>
<bindings
	xmlns="http://www.mozilla.org/xbl"
	xmlns:xbl="http://www.mozilla.org/xbl"
	xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
	
	<binding id="webtree">
		<content>
			<xul:tree xbl:inherits="flex">
				<xul:treecols>
					<xul:treecol label="Path" primary="true" flex="1"/>
					<xul:treecol label="Status"/>
				</xul:treecols>
				<xul:treechildren/>
			</xul:tree>
			<xul:box hidden="true">
				<xul:treeitem role="item" container="false">
					<xul:treerow>
						<xul:treecell role="path"/>
						<xul:treecell role="status"/>
					</xul:treerow>
					<xul:treechildren/>
				</xul:treeitem>
			</xul:box>
		</content>
		<implementation>
			<method name="addUrl">
				<parameter name="url"/>
			    <parameter name="status"/>
				<body><![CDATA[
					var $tree = document.getAnonymousNodes(this)[0];
					var $blueprints = document.getAnonymousNodes(this)[1];
					
					if (status == undefined) {
						var status = 200;
					}
					
					var url = (new String(url)).replace(/\w+?:\/\//, '').replace(/\/+/g, '/').replace(/#.*$/, '').replace(/\/$/, '');
					var tokens = (new String(url)).split('?', 2)[0].split('/');
					
					var $node = $tree;
					
					for (var i = 0; i < tokens.length; i++) {
						$node = $node.getElementsByTagName('xul:treechildren')[0];
						
						var token = tokens[i];
						var $item = $node.getElementsByAttribute('item', token)[0];
						
						if (!$item) {
							var $item = $blueprints.getElementsByAttribute('role', 'item')[0].cloneNode(true);
							$item.setAttribute('item', token);
							
							$node.parentNode.setAttribute('container', 'true');
							$node.appendChild($item);
						}
						
						$item.getElementsByAttribute('role', 'path')[0].setAttribute('label', token);
						
						if (i == tokens.length - 1) {
							$item.getElementsByAttribute('role', 'status')[0].setAttribute('label', status);
						}
						
						$node = $item;
					}
				]]></body>
			</method>
		</implementation>
	</binding>
	
</bindings>