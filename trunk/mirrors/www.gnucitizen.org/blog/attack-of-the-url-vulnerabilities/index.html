<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
	
<!-- Mirrored from www.gnucitizen.org/blog/attack-of-the-url-vulnerabilities/ by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 07 Jul 2012 15:19:20 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
		<link rel="profile" href="http://gmpg.org/xfn/11"/>
		<link rel="pingback" href="../../wordpress/xmlrpc.php" />
		<link rel="alternate" type="application/rdf+xml" title="GNUCITIZEN" href="../../feed/rdf/index.html"/>
		<link rel="alternate" type="application/rss+xml" title="GNUCITIZEN" href="../../feed/rss/index.html"/>
		<link rel="alternate" type="application/atom+xml" title="GNUCITIZEN" href="../../feed/atom/index.html"/>
		<link rel="stylesheet" type="text/css" href="../../wordpress/wp-content/themes/gnucitizen.org-v2/style.css"/>
		<title>GNUCITIZEN &raquo; Attack of the URL Vulnerabilities</title>
			<meta name="google-site-verification" content="yfE2zXU6xxSUp1CWarDop_6vVdGUUplpLF8P5Xe2fWM"/>
	<link rel="icon" href="../../wordpress/wp-content/themes/gnucitizen.org-v2/styles/images/favicon.ico" type="image/x-icon"/>
	<link rel="alternate" type="application/rss+xml" title="GNUCITIZEN Comments" href="http://feedproxy.google.com/gnucitizenComments"/>
	<link rel="alternate" type="application/rss+xml" title="GNUCITIZEN Group" href="http://feedproxy.google.com/gnucitizenGroup"/>
	<link rel="stylesheet" href="../../wordpress/wp-content/themes/gnucitizen.org-v2/scriptlets/slimbox2/slimbox2.css" type="text/css" media="screen"/>
	<script src="../../wordpress/wp-content/themes/gnucitizen.org-v2/scripts/jquery.core.js" type="text/javascript"></script>
	<script src="../../wordpress/wp-content/themes/gnucitizen.org-v2/scriptlets/slimbox2/slimbox2.js" type="text/javascript"></script>
	<script src="../../wordpress/wp-content/themes/gnucitizen.org-v2/scripts/gnucitizen.common.js" type="text/javascript"></script>
<link rel="alternate" type="application/rss+xml" title="GNUCITIZEN &raquo; Attack of the URL Vulnerabilities Comments Feed" href="feed/index.html" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../wordpress/xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.gnucitizen.org/wordpress/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Firefox could also be used as the entry point' href='../firefox-could-also-be-used-as-the-entry-point/index.html' />
<link rel='next' title='Interview with XS-Snipers' href='../interview-with-xs-snipers/index.html' />
<meta name="generator" content="WordPress 3.3.2" />
<link rel='canonical' href='index.html' />
<link rel='shortlink' href='../../index9f0a.html?p=371' />
<link rel="alternate" type="application/rss+xml" title="GNUCITIZEN Network" href="http://feedproxy.google.com/gnucitizenNetwork"/>	</head>
	
	<body id="single" class="blog">
		<div id="header">
			<h1><a href="../../index.html"><span>GNUCITIZEN</span></a></h1>
			<p><span>Information Security Think Tank</span></p>
		</div>

<div id="navigation">
	<h2>Navigation</h2>
	<ul>
		<li class="cat-item cat-item-2"><a href="../../categories/blog/index.html" title="View all posts filed under Blog">Blog</a></li>
		<li class="page_item page-item-266"><a href="../../archive/index.html">Archive</a></li>
<li class="page_item page-item-236"><a href="../../about/index.html">About</a></li>
<li class="page_item page-item-336"><a href="../../index.html">Home</a></li>
			</ul>
</div>

<div id="content">
			<div id="entry">
							<div id="post-371" class="post">
	<div class="post-title"><h2><span>Attack of the URL Vulnerabilities</span></h2></div>
	<div class="post-date"><span>published:</span> July 25th, 2007</div>
	<div class="post-content"><div class="single-content-top-widgets"></div><p>I think that it is getting worse. <a href="http://xs-sniper.com/blog/">Billy Rios</a> has discovered another critical Firefox issue related to the infamous bugs that has been recently discussed on multiple blogs including <a href="../firefox-could-also-be-used-as-the-entry-point/index.html">GC</a> (us), <a href="http://larholm.com/2007/07/18/firefox-fixes-internet-explorer-flaw/">Thor Larholm</a>&#8216;s blog, <a href="http://blog.mozilla.com/security/2007/07/23/related-security-issue-in-url-protocol-handling-on-windows/">Mozilla&#8217;s Security Blog</a>, the <a href="http://www.0x000000.com/?i=401">0&#215;000000</a> hack zine and <a href="http://xs-sniper.com/blog/2007/07/24/remote-command-execution-in-firefox-2005/">Billy (BK) Rios</a>&#8216; personal blog. This time, the bug is extremely dangerous. Fortunately, the issue was fixed in the 2.0.0.6 release candidate.</p>

<p>Billy (BK) Rios comments:</p>

<blockquote><p>These examples were created for WinXP SP2 with no external mail programs installed (outlook, notesâ€¦etc). If you have an external mail program installed, these examples may not work on your machine (as the URI handling may have changed).</p>

<p>Once again, a flaw in the URI handling behavior allows for remote command execution. UNREGISTER ALL UNNECESSARY URIs NOW! This example shows flaws in Firefox, Netscape, and Mozilla browsersâ€¦ other browsers are affected by related vulnerabilities.</p>

<p>Developers who intend to (or have already) registered URIs for their applications MUST UNDERSTAND that registering a URI handler exponentially increases the attack surface for that application. Please review your registered URI handling mechanisms and audit the functionality called by those URIsâ€¦</p></blockquote>

<p>The bug is within mailto, nntp, news and snews protocol handlers. Here is a harmless demonstration of the issue: <a href='mailto:%00%00../../../../../../windows/system32/cmd".exe ../../../../../../../../windows/system32/calc.exe " - " blah.bat'>danger do not click!</a>.</p>

<p><em>It seams like there is a huge interest in URL bug hunting. This is good. At least, we are going to get it right this time. Progressive security!</em></p><div class="single-content-bottom-widgets"></div></div>
		<div class="post-links"><a href="index.html">more</a> | <a href="index.html#post-comments">comments</a> | <a href='feed/index.html'>comments rss</a> | posted by <a href="../../author/pdp/index.html" title="Posts by pdp" rel="author">pdp</a></div>
	</div>
				

				<div id="post-comments">
					<div class="comment even thread-even depth-1" id="comment-36996">
				<div class="comment-author vcard">
		<img alt='' src='http://0.gravatar.com/avatar/290e868e00e8429bf1624a461b8ef81e?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn"><a href='http://noscript.net/' rel='external nofollow' class='url'>Giorgio Maone</a></cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-36996">
			July 25, 2007 at 2:07 pm</a>		</div>

		<p>I&#8217;m won&#8217;t say anything ;)<br />
<a href="http://noscript.net/changelog#1.1.6.07" rel="nofollow">http://noscript.net/changelog#1.1.6.07</a></p>

		<div class="reply">
				</div>
		</div>
		<div class="comment byuser comment-author-pdp bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-36997">
				<div class="comment-author vcard">
		<img alt='' src='http://0.gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn"><a href='../../about/pdp.html' rel='external nofollow' class='url'>pdp</a></cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-36997">
			July 25, 2007 at 2:08 pm</a>		</div>

		<p>good, cuz I am not saying anything either :)</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment even thread-even depth-1" id="comment-37031">
				<div class="comment-author vcard">
		<img alt='' src='http://1.gravatar.com/avatar/129b6f1bf6c627d5ca57779bd15ea649?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn">Jordan</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-37031">
			July 25, 2007 at 7:39 pm</a>		</div>

		<p>Odd &#8212; I&#8217;ve been trying to test this in a base XP image, with no luck.  Does it really require SP2 to work?  That&#8217;d be kind of ironic.  Outlook Express is the default registered mail handler for mailto: on the test system I just installed into vmware.  I&#8217;m going through the upgrades now, testing it at each step to see at what point it becomes vulnerable.</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment byuser comment-author-pdp bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-37032">
				<div class="comment-author vcard">
		<img alt='' src='http://0.gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn"><a href='../../about/pdp.html' rel='external nofollow' class='url'>pdp</a></cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-37032">
			July 25, 2007 at 7:48 pm</a>		</div>

		<p>Jordan, the vector does not work if you have Outlook as a default <strong>mailto:</strong> handler. If your default Mail client is Thunderbird, then you shouldn&#8217;t have any problem with launching the attack. BTW, try using other protocols. It works like a charm.</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment even thread-even depth-1" id="comment-37036">
				<div class="comment-author vcard">
		<img alt='' src='http://1.gravatar.com/avatar/129b6f1bf6c627d5ca57779bd15ea649?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn">Jordan</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-37036">
			July 25, 2007 at 8:00 pm</a>		</div>

		<p>pdp &#8212; there&#8217;s something else involved in the process that&#8217;s disrupting it.</p>
<p>I just grabbed all the updates for the SP2 machine, and /now/ the exploit works.  Outlook Express is still registered as the mailto handler just like it was before I grabbed the updates.  </p>
<p>So in short, install a standard SP2 machine.  Exploit fails.  Install latest security patches.  Exploit succeeds.  </p>
<p>Lemme verify it again and use regmon to trace the registry calls to see if I can find out what&#8217;s different.</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment odd alt thread-odd thread-alt depth-1" id="comment-37038">
				<div class="comment-author vcard">
		<img alt='' src='http://1.gravatar.com/avatar/129b6f1bf6c627d5ca57779bd15ea649?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn">Jordan</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-37038">
			July 25, 2007 at 8:26 pm</a>		</div>

		<p>Ok, just ran it a second time after reverting the snapshot, and sure enough &#8212; a base SP2 machine is /not/ vulnerable for some reason.  Got the regmon logs, but I don&#8217;t have the time to parse through them right now.  </p>
<p>Here&#8217;s a zip with a screenshot showing the exploit fail, regmon logs of the exploit both failing and then succeeding on the same machine just with and without patches:</p>
<p><a href="http://www.psifertex.com/download/firefox-command-injection.zip" rel="nofollow">http://www.psifertex.com/downl.....ection.zip</a></p>
<p>Maybe someone else can figure it out while I get back to pretending to work on this other project here at my office.  ;-)</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment even thread-even depth-1" id="comment-37040">
				<div class="comment-author vcard">
		<img alt='' src='http://0.gravatar.com/avatar/e262088c60a66120c5cf9ab4c54a3e17?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn"><a href='../../index.html' rel='external nofollow' class='url'>Adrian Pastor</a></cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-37040">
			July 25, 2007 at 8:28 pm</a>		</div>

		<p>It&#8217;s very worrying how easy it is to exploit this vulnerability and how well it works.</p>
<p>I must research these URI handler bugs!</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment byuser comment-author-pdp bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-37048">
				<div class="comment-author vcard">
		<img alt='' src='http://0.gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn"><a href='../../about/pdp.html' rel='external nofollow' class='url'>pdp</a></cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-37048">
			July 25, 2007 at 9:38 pm</a>		</div>

		<p>Jordan, again, it depends on the URL handler for the <strong>mailto:</strong> protocol.</p>
<p>Adrian, yes, yes and yes.</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment even thread-even depth-1" id="comment-37074">
				<div class="comment-author vcard">
		<img alt='' src='http://1.gravatar.com/avatar/129b6f1bf6c627d5ca57779bd15ea649?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn">Jordan</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-37074">
			July 26, 2007 at 2:02 am</a>		</div>

		<p>pdp &#8212; I realize that, but there&#8217;s something else going on.  Check this out to see what I mean:</p>
<p>XPSP2 with no patches + Firefox = Exploit fails<br />
XPSP2 with all patches (sans IE7) + Firefox = Exploit fails<br />
XPSP2 with all patches (including IE7) + Firefox = Exploit succeeds!<br />
XPSP2 with no patches + Firefox + Thunderbird installed and configured = Exploit fails<br />
XPSP2 with no patches except for IE7 + Firefox + Thunderbird = Exploit succeeds!</p>
<p>I&#8217;ve tried other combinations besides those, and the only way I can get the exploit to succeed is if IE7 is installed.  If anyone&#8217;s able to get the exploit working without IE7 installed, I&#8217;d be really curious to know.</p>

		<div class="reply">
				</div>
		</div>
		<div class="comment odd alt thread-odd thread-alt depth-1" id="comment-37087">
				<div class="comment-author vcard">
		<img alt='' src='http://1.gravatar.com/avatar/129b6f1bf6c627d5ca57779bd15ea649?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn">Jordan</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-37087">
			July 26, 2007 at 3:31 am</a>		</div>

		<p>Looks like I&#8217;m not the only person to observe that:</p>
<p><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=389580#c6" rel="nofollow">https://bugzilla.mozilla.org/show_bug.cgi?id=389580#c6</a></p>

		<div class="reply">
				</div>
		</div>
		<div class="comment byuser comment-author-pdp bypostauthor even thread-even depth-1" id="comment-37116">
				<div class="comment-author vcard">
		<img alt='' src='http://0.gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=32&amp;d=retro&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' />		<cite class="fn"><a href='../../about/pdp.html' rel='external nofollow' class='url'>pdp</a></cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="comment-page-1/index.html#comment-37116">
			July 26, 2007 at 7:43 am</a>		</div>

		<p>Jordan, thanks for the good research. yes, it is very interesting. Have you taken snapshots of the registry tree for each setup? because now we can detect what&#8217;s the cause of it. I have some very wild guess but it is good to have some proof. cheers</p>

		<div class="reply">
				</div>
		</div>
		</div>
		
		<div class="post-comments-navigation">
			<div class="older-comments"></div>
			<div class="newer-comments"></div>
		</div>
	
	<div id="post-response">
		<h2>Respond</h2>
					<form action="http://www.gnucitizen.org/wordpress/wp-comments-post.php" name="response-form" method="post" class="response-form">
				<p><em>We retain the right to remove any comment or trackback we determine to be, at our sole discretion, unacceptable.</em></p>
									<div><label for="author">name: (required)</label></div>
					<div><input type="text" name="author" id="author" value="" size="20" tabindex="1"/></div>
					<div><label for="email">mail: (required)</label></div>
					<div><input type="text" name="email" id="email" value="" size="20" tabindex="2"/></div>
					<div><label for="url">website:</label></div>
					<div><input type="text" name="url" id="url" value="" size="20" tabindex="3"/></div>
								<div><label for="comment">comment:</label></div>
				<div><textarea name="comment" id="comment" cols="50" rows="10" tabindex="4"></textarea></div>
				<div>
					<input class="button" name="submit" type="submit" id="submit" tabindex="5" value="submit"/>
					<input class="button" name="reset" type="reset" id="reset" tabindex="6" value="reset"/>
				</div>
				<input type="hidden" name="comment_post_ID" value="371"/>
				<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="edcfca459b" /></p>

	<p style="clear: both;" class="subscribe-to-comments">
	<input type="checkbox" name="subscribe" id="subscribe" value="subscribe" style="width: auto;" />
	<label for="subscribe">Notify me of followup comments via e-mail</label>
	</p>


			</form>
			</div>
					</div>
		<div id="content-sidebar">					<div class="widget">			<p style="font-size:24px"><em>Get <a href="http://www.websecurify.com/">Websecurify</a> - a cross-platform web security testing technology designed from the ground up with simplicity in mind.</em></p>			</div>			</div></div>

				
		<div id="footer">
			
	<script type="text/javascript">
		var gaJsHost = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.');
		document.write(unescape('%3Cscript src="' + gaJsHost + 'google-analytics.com/ga.js" type="text/javascript"%3E%3C/script%3E'));
	</script>
	<script type="text/javascript">
		var pageTracker = _gat._getTracker('UA-363996-1');
		pageTracker._initData();
		pageTracker._trackPageview();
	</script>

				<p>(<a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/2.5/" title="Creative Commons Attribution-Noncommercial-No Derivative Works 2.5 Generic">CC</a>)2005-2012 <a href="../../index.html" title="Information Security Think Tank">GNUCITIZEN</a></p>
		</div>
		
		<!-- <rdf:RDF xmlns="http://web.resource.org/cc/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
			<Work rdf:about="">
				<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/2.5/"/>
				<dc:title>GNUCITIZEN</dc:title>
				<dc:date>2005-2012</dc:date>
				<dc:creator><Agent><dc:title>GNUCITIZEN</dc:title></Agent></dc:creator>
				<dc:rights><Agent><dc:title>GNUCITIZEN</dc:title></Agent></dc:rights>
				<dc:type rdf:resource="http://purl.org/dc/dcmitype/Text"/>
				<dc:source rdf:resource="http://www.gnucitizen.org"/>
			</Work>
			<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/2.5/">
				<permits rdf:resource="http://web.resource.org/cc/Reproduction"/>
				<permits rdf:resource="http://web.resource.org/cc/Distribution"/>
				<requires rdf:resource="http://web.resource.org/cc/Notice"/>
				<requires rdf:resource="http://web.resource.org/cc/Attribution"/>
				<prohibits rdf:resource="http://web.resource.org/cc/CommercialUse"/>
			</License>
		</rdf:RDF> -->
		
		<!-- tested by blogsecurify -->
		<!-- wpscanner -->
	</body>

<!-- Mirrored from www.gnucitizen.org/blog/attack-of-the-url-vulnerabilities/ by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 07 Jul 2012 15:19:20 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
</html>
